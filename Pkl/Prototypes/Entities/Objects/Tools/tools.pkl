amends ".../Typings.pkl"

import ".../Typings.pkl"
import ".../Prototypes/rpd.pkl"

local const rpdPrototypes = rpd
    .content
    .toList()
    .map((p) -> p.id)
    .toSet()
    .add("Deconstruct")

content {
    new EntityPrototype {
        parent { "RCD" }
        id = "RPD"
        components {
            new TagComponent {
                tags = Set("RPD")
            }
            new RCDComponent {
                isRpd = true
                availablePrototypes = rpdPrototypes
            }
            new LimitedChargesComponent {
                maxCharges = 50
                charges = 50
            }
            new SpriteComponent {
                sprite = "/Textures/Objects/Tools/rpd.rsi"
            }
            new PhysicalCompositionComponent {
                materialComposition {
                    ["Steel"] = 500
                    ["Plastic"] = 150
                    ["Circuitry"] = 50
                }
            }
            new StaticPriceComponent {
                price = 100.0
            }
            new ReverseEngineeringComponent {
                difficulty = 3
                recipes {
                    "RPD"
                }
            }
            new FixturesComponent {
                fixtures {
                    ["fix1"] {
                        shape = new PhysShapeAabb {
                            bounds = Typings.Box2(-0.25, -0.25, 0.25, 0.25)
                        }
                        density = 65.0
                        mask = Set("ItemMask")
                        restitution = 0.3
                        friction = 0.2
                    }
                }
            }
        }
    }

    new EntityPrototype {
        parent { "RPD" }
        id = "RPDEmpty"
        components {
            new LimitedChargesComponent {
                charges = 0
            }
            new TagComponent {
                tags = Set("RPD")
            }
            new RCDComponent {
                isRpd = true
                availablePrototypes = rpdPrototypes
            }
        }
    }
}
